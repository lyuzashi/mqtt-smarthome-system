# No password set for sudo
sudo apt update
sudo apt full-upgrade -y

# Install node (finding latest version for major in .nvmrc, using correct arch version)
SOURCE="https://nodejs.org/dist/latest"
MAJOR="$(sed -En 's/[^0-9]*([0-9]+).*/\1/p' .nvmrc)"
ARM="$(sed -n 's/model name.*(\(\S*\)).*$/\1/p' /proc/cpuinfo)"
NODE="$(curl -sL $SOURCE-v$MAJOR.x | grep arm$ARM.tar.xz | cut -d'"' -f2)"
wget -O node.tar.xz $SOURCE/$NODE
tar -xf node.tar.xz
chmod -R 755 node*/bin/*
sudo cp -r node*/{bin,lib,share} /usr/local
rm -r node*

# Install binary deps 
sudo apt install libasound2-dev alsa-base alsa-utils bluetooth libbluetooth-dev libudev-dev git -y
sudo rpi-update
reboot

sudo npm install -g pm2
